tosca_definitions_version: cloudify_dsl_1_3


imports:
  - http://www.getcloudify.org/spec/cloudify/3.4/types.yaml
  - ../plugin.yaml


inputs:
  role:
    type: string
    default: arn:aws:iam::535075449278:role/lambda_basic_execution

  aws_config:
    required: false


outputs:
  cats_table:
    description: dynamoDB table
    value:
      name: { get_attribute: [cats_table, name] }


node_templates:
  dynamodb_lambda:
    type: cloudify.aws.nodes.LambdaFunction
    properties:
      code_path: code.py
      runtime: python2.7
      handler: code.main
      role: { get_input: role }
      aws_config: { get_input: aws_config }

  cats_table:
    type: cloudify.aws.nodes.DynamoDBTable
    properties:
      aws_config: { get_input: aws_config }
      attribute_definitions:
        - [cat_name, S]
      key_schema:
        - [cat_name, HASH]
